<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">

<dom-module id="caribou-year">
    <template>
        <style>
            :host {
                display: block;
                overflow-y: auto;
                height: 394px;
                /*Padding added to hide the scrollbar*/
                padding-right: 20px;
                width: 100%;
            }

            :host([hidden]) {
                display: none;
            }

            .years {
                @apply --layout-vertical;
            }

            .years paper-button {
                font-size: 15px;
            }

            .years paper-button .active {
                padding: 5px;
                color: #009688;
                font-size: 25px;
            }

            .iconBtnNav {
                margin: auto;
            }
        </style>

        <div id="years" class="years">
            <template is="dom-repeat" items="{{years}}">
                <paper-button data-year$="{{item.value}}" on-tap="_setYear">
                    <span class$="{{_getClassYear(item.isCurrentYear, item.isActiveYear)}}">{{item.value}}</span>
                </paper-button>
            </template>
        </div>
    </template>

    <script>
        /**
         * `caribou-datepicker`
         * Polymer 2 element used to select a date picker following material design.
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class CaribouYearElement extends Polymer.Element {
            static get is() {
                return 'caribou-year';
            }

            static get properties() {
                return {
                    year: {
                        type: Number
                    },

                    currentYear: {
                        type: Number
                    },

                    years: {
                        type: Array,
                        value: function () {
                            return []
                        }
                    },

                    init: {
                        type: Array,
                        value: false
                    },

                    lastYear: {
                        type: Number
                    },

                    firstYear: {
                        type: Number
                    }
                };
            }

            ready() {
                super.ready();

                this.$.years.addEventListener("mousewheel", this._mouseYearNav.bind(this));

                console.log('caribou-year', "SET YEAR BUILT IN");
                this.year = 2018;

                //initialize the year view
                this._getNextYears();
            }


            _getNextYears() {
                if (this.lastYear === undefined)
                    this.lastYear = this.year;

                if (!this.init) {
                    this.push('years', this._getYearObject(Number(this.lastYear - 3), false));
                    this.push('years', this._getYearObject(Number(this.lastYear - 2), false));
                    this.push('years', this._getYearObject(Number(this.lastYear - 1), false));
                    this.push('years', this._getYearObject(Number(this.lastYear), false));
                    this.init = true;
                }

                for (var i = 0; i < 20; i++) {
                    this.lastYear = this.lastYear + 1;
                    this.push('years', this._getYearObject(Number(this.lastYear), false));
                }
            }

            _getPreviousYears() {
                if (this.firstYear === undefined)
                    this.firstYear = this.year - 3;

                for (var i = 0; i < 20; i++) {
                    this.firstYear = this.firstYear - 1;
                    this.splice("years", 0, 0, this._getYearObject(Number(this.firstYear), false));
                }

                this.scrollTop = 600;
            }

            _getYearObject(year, isActiveYear) {
                let isCurrentYear = false;
                if (this.currentYear === year)
                    isCurrentYear = true;

                return {
                    value: year,
                    isCurrentYear: isCurrentYear,
                    isActiveYear: isActiveYear
                };
            }

            _getClassYear(isCurrentYear, isActiveYear) {
                if (isActiveYear) return "active";
                if (isCurrentYear) return "current";
            }

            // nextYear() {
            //     this.year = Number(this.year) + 1;
            // }

            // previousYear() {
            //     this.year = Number(this.year) - 1;
            // }

            _mouseYearNav(e) {
                //e.wheelDelta >= 0  go to top otherwise go to bottom
                if (e.wheelDelta >= 0 && this.scrollTop === 0) {
                    this._getPreviousYears();
                } else if (this.scrollTop + this.clientHeight >= this.scrollHeight) {
                    this._getNextYears();
                }
            }

            _setYear(e) {
                this.dispatchEvent(new CustomEvent('year-selected', {
                    bubbles: true,
                    composed: true,
                    detail: {
                        year: e.currentTarget.dataset.year
                    }
                }));
                this.year = e.currentTarget.dataset.year;
                console.log("caribou-year", "Year selected : " + this.year);
            }
        }

        window.customElements.define(CaribouYearElement.is, CaribouYearElement);
    </script>
</dom-module>