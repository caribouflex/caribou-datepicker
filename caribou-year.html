<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<dom-module id="caribou-year">
    <template>
        <style>
            :host {
                display: block;
            }

            :host([hidden]) {
                display: none;
            }

            .years {
                @apply --layout-vertical;
            }

            .years paper-button {
                font-size: 15px;
            }

            .years paper-button .active {
                padding: 5px;
                color: #009688;
                font-size: 25px;
            }

            .iconBtnNav {
                margin: auto;
            }
        </style>

        <div id="years" class="years">
            <paper-icon-button class="iconBtnNav" on-tap="previousYear" icon="caribou-datepicker-icons:chevron-top"></paper-icon-button>
            <template is="dom-repeat" items="{{_getArrayOfYears(year)}}">
                <paper-button data-year$="{{item.value}}" on-tap="_setYear">
                    <span class$="{{_getClassYear(item.isCurrentYear, item.isActiveYear)}}">{{item.value}}</span>
                </paper-button>
            </template>
            <paper-icon-button class="iconBtnNav" on-tap="nextYear" icon="caribou-datepicker-icons:chevron-bottom"></paper-icon-button>
    </template>

    <script>
        /**
         * `caribou-datepicker`
         * Polymer 2 element used to select a date picker following material design.
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */
        class CaribouYearElement extends Polymer.Element {
            static get is() {
                return 'caribou-year';
            }

            static get properties() {
                return {
                    year: {
                        type: Number
                    },

                    currentYear: {
                        type: Number
                    }
                };
            }

            ready() {
                super.ready();
                this.$.years.addEventListener("mousewheel", this._mouseYearNav.bind(this));
                console.log("SET YEAR BUILT IN");
                this.year = 2018;

            }

            _getArrayOfYears() {
                let yearsArray = new Array();
                yearsArray[0] = this._getYearObject(Number(this.year) - 3, false);
                yearsArray[1] = this._getYearObject(Number(this.year) - 2, false);
                yearsArray[2] = this._getYearObject(Number(this.year) - 1, false);
                yearsArray[3] = this._getYearObject(Number(this.year), true);
                yearsArray[4] = this._getYearObject(Number(this.year) + 1, false);
                yearsArray[5] = this._getYearObject(Number(this.year) + 2, false);
                yearsArray[6] = this._getYearObject(Number(this.year) + 3, false);

                return yearsArray;
            }

            _getYearObject(year, isActiveYear) {
                let isCurrentYear = false;
                if (this.currentYear === year)
                    isCurrentYear = true;

                return {
                    value: year,
                    isCurrentYear: isCurrentYear,
                    isActiveYear: isActiveYear
                };
            }

            _getClassYear(isCurrentYear, isActiveYear) {
                if (isActiveYear) return "active";
                if (isCurrentYear) return "current";
            }

            nextYear() {
                this.year = Number(this.year) + 1;
            }

            previousYear() {
                this.year = Number(this.year) - 1;
            }

            _mouseYearNav(e) {
                if (e.wheelDelta >= 0) {
                    console.log('Scroll up');
                    this.previousYear();
                } else {
                    console.log('Scroll down');
                    this.nextYear();
                }
            }

            _setYear(e) {
                this.dispatchEvent(new CustomEvent('year-selected', {
                    bubbles: true,
                    composed: true,
                    detail: {
                        year: e.currentTarget.dataset.year
                    }
                }));
                this.year = e.currentTarget.dataset.year;
                console.log("Year selected : " + this.year);
            }
        }

        window.customElements.define(CaribouYearElement.is, CaribouYearElement);
    </script>
</dom-module>