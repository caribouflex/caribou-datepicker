<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<!-- <link rel="import" href="ssn-validator.html"> -->

<dom-module id="caribou-date-input">
    <template>
        <style>
            :host {
                display: inline-block;
            }

            :host([hidden]) {
                display: none !important;
            }

            input {
                font: inherit;
                outline: none;
                box-shadow: none;
                border: none;
                width: auto;
                text-align: center;
                width: 55px;
            }

            .container {
                @apply --layout-horizontal;
            }
        </style>

        <template is="dom-if" if="{{__isDMY}}">
            <div class="container">
                <iron-input bind-value="{{_sDateD}}" aria-label="2 digits of the Date">
                    <input max="31" min="1" size="2" type="number" placeholder="DD">
                </iron-input>
                /
                <iron-input bind-value="{{_sDateM}}" aria-label="2 digits of the Month">
                    <input max="12" min="1" size="2" type="number" placeholder="MM">
                </iron-input>
                /
                <iron-input bind-value="{{dateY}}" aria-label="4 digits of the Year">
                    <input min="1900" size="4" type="number" placeholder="YYYY">
                </iron-input>
            </div>
        </template>
        <template is="dom-if" if="{{__isYMD}}">
            <div class="container">
                <iron-input bind-value="{{dateY}}" aria-label="4 digits of the Year">
                    <input min="1900" size="4" type="number" placeholder="YYYY">
                </iron-input>
                /
                <iron-input bind-value="{{_sDateM}}" aria-label="2 digits of the Month">
                    <input max="12" min="1" size="2" type="number" placeholder="MM">
                </iron-input>
                /
                <iron-input bind-value="{{_sDateD}}" aria-label="2 digits of the Date">
                    <input max="31" min="1" size="2" type="number" placeholder="DD">
                </iron-input>
            </div>
        </template>
        <template is="dom-if" if="{{__isMDY}}">
            <div class="container">
                <iron-input bind-value="{{_sDateM}}" aria-label="2 digits of the Month">
                    <input max="12" min="1" size="2" type="number" placeholder="MM">
                </iron-input>
                /
                <iron-input bind-value="{{_sDateD}}" aria-label="2 digits of the Date">
                    <input max="31" min="1" size="2" type="number" placeholder="DD">
                </iron-input>
                /
                <iron-input bind-value="{{dateY}}" aria-label="4 digits of the Year">
                    <input min="1900" size="4" type="number" placeholder="YYYY">
                </iron-input>
            </div>
        </template>
    </template>

    <script>
        class CaribouDateInput extends Polymer.mixinBehaviors([Polymer.IronValidatableBehavior], Polymer.Element) {
            static get is() {
                return 'caribou-date-input';
            }

            static get properties() {
                return {
                    _sDateD: {
                        type: String,
                        observer: "_setDateD"
                    },
                    _sDateM: {
                        type: String,
                        observer: "_setDateM"
                    },
                    _sDateY: {
                        type: String
                    },
                    dateD: {
                        type: Number,
                        notify: true,
                        observer: "_set_sDateD"
                    },
                    dateM: {
                        type: Number,
                        notify: true,
                        observer: "_set_sDateM"
                    },
                    dateY: {
                        type: Number,
                        notify: true
                    },
                    validator: {
                        type: String,
                        value: 'ssn-validator'
                    },
                    invalidDate: {
                        type: Boolean,
                        value: false,
                        notify: true
                    },

                    /**
                     * This is the format of the date for the input.
                     * Possible values : 
                     *  - DMY
                     *  - YMD
                     *  - MDY
                     */
                    format: {
                        type: String,
                        value: "DMY",
                        observer: "_initFormat"
                    },

                    __isDMY: {
                        type: Boolean,
                        value: false,
                        readOnly: true
                    },

                    __isYMD: {
                        type: Boolean,
                        value: false,
                        readOnly: true
                    },

                    __isMDY: {
                        type: Boolean,
                        value: false,
                        readOnly: true
                    }
                }
            }

            static get observers() {
                return [
                    "_computeValue(dateD, dateM, dateY)"
                ];
            }

            _computeValue(dateD, dateM, dateY) {
                if (dateD !== undefined && dateM !== undefined && dateY !== undefined) {
                    this._validDate();
                }
            }

            _validDate() {
                var date = new Date(this.dateY, this.dateM - 1, this.dateD);
                if (this.dateY < 1900 || !date || (date.getMonth() + 1) != this.dateM) {
                    this.invalidDate = true;
                } else
                    this.invalidDate = false;

                return this.invalidDate;
            }

            _initFormat(format) {
                switch (format) {
                    case "DMY":
                        this._set__isDMY(true);
                        this._set__isYMD(false);
                        this._set__isMDY(false);
                        break;
                    case "YMD":
                        this._set__isYMD(true);
                        this._set__isDMY(false);
                        this._set__isMDY(false);
                        break;
                    case "MDY":
                        this._set__isMDY(true);
                        this._set__isYMD(false);
                        this._set__isDMY(false);
                        break;
                    default:
                        this.format = "DMY";
                }
            }

            _setDateD(value) {
                this.dateD = Number(value);
            }

            _setDateM(value) {
                this.dateM = Number(value);
            }

            _set_sDateD(value) {
                this._sDateD = (value < 10 ? '0' : '') + value;
            }

            _set_sDateM(value) {
                this._sDateM = (value < 10 ? '0' : '') + value;
            }
        }

        window.customElements.define(CaribouDateInput.is, CaribouDateInput);
    </script>
</dom-module>